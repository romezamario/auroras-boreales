<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>VisualizaciÃ³n de Auroras (OVATION)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Hoja de estilos principal de la app -->
  <link rel="stylesheet" href="style.css">

  <!-- Libs externas: D3 + TopoJSON + helper de rotaciÃ³n -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3"></script>
  <script src="versor.js"></script>
</head>

<body>
  <div class="app-shell">
    <!-- Encabezado con tÃ­tulo y metadatos del panel -->
    <header class="app-header">
      <div class="title-block">
        <p class="eyebrow">OVATION Â· VisualizaciÃ³n de Auroras</p>
        <h1>Mapa en tiempo real de actividad auroral</h1>
        <p class="subtitle">Filtra intensidad y nubosidad para enfocar zonas con mayor visibilidad.</p>
      </div>
      <div class="header-meta">
        <button id="refresh-btn">ðŸ”„ Refrescar datos</button>
      </div>
    </header>

    <div class="layout">
      <!-- Panel lateral con controles y leyendas -->
      <aside class="controls">
        <div class="card">
          <div class="card-header">
            <h2>Capas visibles</h2>
            <p>Activa o desactiva fuentes para comparar lecturas.</p>
          </div>
          <div class="layer-controls-items">
            <label class="toggle">
              <input type="checkbox" id="toggle-aurora" checked>
              <span class="toggle-text">Auroras</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="toggle-clouds" checked>
              <span class="toggle-text">Nubosidad</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="toggle-day-night" checked>
              <span class="toggle-text">DÃ­a / noche</span>
            </label>
          </div>
        </div>

        <div class="card legend-slider">
          <div class="card-header">
            <h2>Intensidad (OVATION)</h2>
            <p>Define el umbral mÃ­nimo que se visualizarÃ¡ en el mapa.</p>
          </div>
          <div class="legend-header">
            <span class="legend-title">Umbral actual</span>
            <span id="threshold-value" class="legend-value">â‰¥ 5</span>
          </div>

          <div class="legend-bar-container">
            <div class="legend-bar"></div>
            <input
              type="range"
              id="threshold-range"
              class="legend-range"
              min="5"
              max="80"
              step="1"
              value="5"
              aria-label="Umbral de intensidad"
            />
          </div>

          <div class="legend-ticks">
            <span>5</span>
            <span>20</span>
            <span>40</span>
            <span>60</span>
            <span>80</span>
          </div>
        </div>

        <div class="card cloud-legend">
          <div class="card-header">
            <h2>Nubosidad (cobertura)</h2>
            <p>Reduce la nubosidad mÃ¡xima para ver zonas despejadas.</p>
          </div>
          <div class="legend-header">
            <span class="legend-title">Nubosidad visible</span>
            <span class="legend-values">
              <span id="cloud-threshold-value" class="legend-value">â‰¥ 12%</span>
            </span>
          </div>

          <div class="legend-bar-container">
            <div class="legend-bar"></div>
            <input
              type="range"
              id="cloud-threshold-range"
              class="legend-range"
              min="0"
              max="100"
              step="1"
              value="12"
              aria-label="Umbral de nubosidad"
            />
          </div>

          <div class="legend-ticks">
            <span>0%</span>
            <span>25%</span>
            <span>50%</span>
            <span>75%</span>
            <span>100%</span>
          </div>
        </div>

        <div class="card inspector-card is-collapsed" id="globe-inspector">
          <div class="card-header inspector-header">
            <div>
              <h2>Detalle del punto</h2>
              <p>Haz clic en el globo para consultar el estado local.</p>
            </div>
            <button class="inspector-toggle" id="inspector-toggle" type="button" aria-expanded="false">
              <span class="inspector-toggle-label">Expandir</span>
              <span class="inspector-toggle-icon" aria-hidden="true">â–¾</span>
            </button>
          </div>
          <div class="inspector-body">
            <div class="inspector-grid">
              <div class="inspector-item">
                <span class="inspector-label">Latitud</span>
                <span id="inspector-lat" class="inspector-value">â€”</span>
              </div>
              <div class="inspector-item">
                <span class="inspector-label">Longitud</span>
                <span id="inspector-lon" class="inspector-value">â€”</span>
              </div>
              <div class="inspector-item">
                <span class="inspector-label">Intensidad</span>
                <span id="inspector-intensity" class="inspector-value">â€”</span>
              </div>
              <div class="inspector-item">
                <span class="inspector-label">Nubosidad</span>
                <span id="inspector-clouds" class="inspector-value">â€”</span>
              </div>
              <div class="inspector-item">
                <span class="inspector-label">DÃ­a / noche</span>
                <span id="inspector-daynight" class="inspector-value">â€”</span>
              </div>
            </div>
            <p class="inspector-hint" id="inspector-hint">Selecciona un punto visible para ver detalles.</p>
          </div>
        </div>

        <div class="card inspector-card is-collapsed" id="location-inspector">
          <div class="card-header inspector-header">
            <div>
              <h2>LocalizaciÃ³n inferida</h2>
              <p>Se basa en la IP desde donde se realiza la consulta.</p>
            </div>
            <button class="inspector-toggle" id="location-toggle" type="button" aria-expanded="false">
              <span class="inspector-toggle-label">Expandir</span>
              <span class="inspector-toggle-icon" aria-hidden="true">â–¾</span>
            </button>
          </div>
          <div class="inspector-body">
            <div class="inspector-grid">
              <div class="inspector-item">
                <span class="inspector-label">Estado</span>
                <span id="location-state" class="inspector-value">â€”</span>
              </div>
              <div class="inspector-item">
                <span class="inspector-label">PaÃ­s</span>
                <span id="location-country" class="inspector-value">â€”</span>
              </div>
            </div>
            <p class="inspector-hint" id="location-hint">Esperando datos de localizaciÃ³n.</p>
          </div>
        </div>

        <div class="card data-status">
          <div class="card-header">
            <h2>Estado de datos</h2>
            <p>Consulta la versiÃ³n y el Ãºltimo refresco del feed.</p>
          </div>
          <div class="data-status-grid">
            <div class="meta-item">
              <span class="meta-label">VersiÃ³n</span>
              <p id="app-version">â€”</p>
            </div>
            <div class="meta-item">
              <span class="meta-label">Ãšltima actualizaciÃ³n</span>
              <p id="last-update">â€”</p>
            </div>
          </div>
        </div>
      </aside>

      <!-- Zona principal con el canvas del globo -->
      <main class="visual">
        <div class="canvas-card">
          <canvas id="globe"></canvas>
        </div>
      </main>
    </div>
  </div>

  <!-- App core: config, utilidades, estado y eventos -->
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/state.js"></script>
  <script src="js/events.js"></script>

  <!-- Services de datos remotos/locales -->
  <script src="js/data/world.service.js"></script>
  <script src="js/data/ovation.service.js"></script>
  <script src="js/data/clouds.service.js"></script>
  <script src="js/data/location.service.js"></script>

  <!-- UI: widgets y controles -->
  <script src="js/ui/version.ui.js"></script>
  <script src="js/ui/refresh.ui.js"></script>
  <script src="js/ui/threshold.ui.js"></script>
  <script src="js/ui/clouds.ui.js"></script>
  <script src="js/ui/layers.ui.js"></script>
  <script src="js/ui/inspector.ui.js"></script>
  <script src="js/ui/location.ui.js"></script>

  <!-- Overlays del globo (nubes, noche, auroras) -->
  <script src="js/overlays/clouds.utils.js"></script>
  <script src="js/overlays/clouds.overlay.js"></script>
  <script src="js/overlays/day-night.overlay.js"></script>
  <script src="js/overlays/aurora.overlay.js"></script>

  <!-- Globe: core, interacciÃ³n y render -->
  <script src="js/globe/globe.core.js"></script>
  <script src="js/globe/globe.drag.js"></script>
  <script src="js/globe/globe.pick.js"></script>
  <script src="js/globe/globe.markers.js"></script>
  <script src="js/globe/globe.render.js"></script>

  <!-- Bootstrap general de la app -->
  <script src="js/app.js"></script>

</body>
</html>
